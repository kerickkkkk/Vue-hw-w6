import{_ as C,r as V,o as d,c as r,a as e,d as p,F as v,g as x,h as f,t as i,b as n,w as I,f as k,v as E,i as b}from"./index-aadb2e42.js";const{VITE_APP_URL:c,VITE_APP_PATH:m}={VITE_BASE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"vue3",BASE_URL:"/vue-hw-w6/",MODE:"production",DEV:!1,PROD:!0},U={data(){return{products:[],productId:"",cart:{},loadingItem:"",isLoading:!1,form:{user:{name:"",email:"",tel:"",address:""},message:""}}},methods:{getCarts(){this.$http.get(`${c}api/${m}/cart`).then(t=>{this.cart=t.data.data}).catch(t=>{alert(t.data.message)})},updateCartItem(t){const s={product_id:t.product.id,qty:t.qty};this.loadingItem=t.id,this.$http.put(`${c}api/${m}/cart/${t.id}`,{data:s}).then(g=>{this.getCarts(),this.loadingItem=""}).catch(g=>{alert(g.data.message)})},deleteItem(t){this.loadingItem=t.id,this.$http.delete(`${c}api/${m}/cart/${t.id}`).then(s=>{this.getCarts(),this.loadingItem=""}).catch(s=>{alert(s.data.message)})},deleteCarts(){this.$http.delete(`${c}api/${m}/carts`).then(t=>{this.getCarts()}).catch(t=>{alert(t.data.message)})},isPhone(t){return t?/^(09)[0-9]{8}$/.test(t)?!0:"需要正確的電話號碼":"電話 為必填"},sendOrder(){const t=this.form;this.$http.post(`${c}api/${m}/order`,{data:t}).then(s=>{alert(s.data.message),this.$refs.form.resetForm(),this.form.message="",this.getCarts()}).catch(s=>{alert(s.data.message)})}},mounted(){this.getCarts()}},w={class:"container"},P={class:"table align-middle"},q=e("thead",null,[e("tr",null,[e("th"),e("th",null,"品名"),e("th",{style:{width:"150px"}},"數量/單位"),e("th",null,"單價")])],-1),F=["onClick","disabled"],T={key:0,class:"fas fa-spinner fa-pulse"},A={key:0,class:"text-success"},N={class:"input-group input-group-sm"},S={class:"input-group mb-3"},B=["onUpdate:modelValue","onChange","disabled"],D=["value"],L={class:"input-group-text",id:"basic-addon2"},M={class:"text-end"},O={key:0,class:"text-success"},R=e("td",{colspan:"3",class:"text-end"},"總計",-1),$={class:"text-end"},H=e("td",{colspan:"3",class:"text-end text-success"},"折扣價",-1),j={class:"text-end text-success"},z={class:"my-5 row justify-content-center"},G={class:"mb-3"},J=e("label",{for:"email",class:"form-label"},"Email",-1),K={class:"mb-3"},Q=e("label",{for:"name",class:"form-label"},"收件人姓名",-1),W={class:"mb-3"},X=e("label",{for:"tel",class:"form-label"},"收件人電話",-1),Y={class:"mb-3"},Z=e("label",{for:"address",class:"form-label"},"收件人地址",-1),ee=e("div",{class:"mb-3"},[e("label",{for:"message",class:"form-label"},"留言"),e("textarea",{id:"message",class:"form-control",cols:"30",rows:"10"})],-1),te=e("div",{class:"text-end"},[e("button",{type:"submit",class:"btn btn-danger"},"送出訂單")],-1);function se(t,s,g,le,l,u){const h=V("VeeField"),_=V("ErrorMessage"),y=V("VeeForm");return d(),r(v,null,[e("div",w,[p(" 這是購物車頁面 "),e("table",P,[q,e("tbody",null,[l.cart.carts?(d(!0),r(v,{key:0},x(l.cart.carts,a=>(d(),r("tr",{key:a.id},[e("td",null,[e("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:o=>u.deleteItem(a),disabled:a.id===l.loadingItem},[l.loadingItem===a.id?(d(),r("i",T)):f("",!0),p(" x ")],8,F)]),e("td",null,[p(i(a.product.title)+" ",1),a.coupon?(d(),r("div",A,"已套用優惠券")):f("",!0)]),e("td",null,[e("div",N,[e("div",S,[k(e("select",{name:"",id:"",class:"form-select","onUpdate:modelValue":o=>a.qty=o,onChange:o=>u.updateCartItem(a),disabled:a.id===l.loadingItem},[(d(),r(v,null,x(20,o=>e("option",{value:o,key:`${o}12456`},i(o),9,D)),64))],40,B),[[E,a.qty]]),e("span",L,i(a.product.unit),1)])])]),e("td",M,[l.cart.final_total!==l.cart.total?(d(),r("small",O,"折扣價：")):f("",!0),p(" "+i(a.final_total),1)])]))),128)):f("",!0)]),e("tfoot",null,[e("tr",null,[R,e("td",$,i(l.cart.total),1)]),e("tr",null,[H,e("td",j,i(l.cart.final_total),1)])])])]),e("div",z,[n(y,{ref:"form",class:"col-md-6",onSubmit:u.sendOrder},{default:I(({errors:a})=>[e("div",G,[J,n(h,{id:"email",name:"email",type:"email",class:b(["form-control",{"is-invalid":a.email}]),placeholder:"請輸入 Email",rules:"email|required",modelValue:l.form.user.email,"onUpdate:modelValue":s[0]||(s[0]=o=>l.form.user.email=o)},null,8,["class","modelValue"]),n(_,{name:"email",class:"invalid-feedback"})]),e("div",K,[Q,n(h,{id:"name",name:"姓名",type:"text",class:b(["form-control",{"is-invalid":a.姓名}]),placeholder:"請輸入姓名",rules:"required",modelValue:l.form.user.name,"onUpdate:modelValue":s[1]||(s[1]=o=>l.form.user.name=o)},null,8,["class","modelValue"]),n(_,{name:"姓名",class:"invalid-feedback"})]),e("div",W,[X,n(h,{id:"tel",name:"電話",type:"text",class:b(["form-control",{"is-invalid":a.電話}]),placeholder:"請輸入電話",rules:u.isPhone,modelValue:l.form.user.tel,"onUpdate:modelValue":s[2]||(s[2]=o=>l.form.user.tel=o)},null,8,["class","rules","modelValue"]),n(_,{name:"電話",class:"invalid-feedback"})]),e("div",Y,[Z,n(h,{id:"address",name:"地址",type:"text",class:b(["form-control",{"is-invalid":a.地址}]),placeholder:"請輸入地址",rules:"required",modelValue:l.form.user.address,"onUpdate:modelValue":s[3]||(s[3]=o=>l.form.user.address=o)},null,8,["class","modelValue"]),n(_,{name:"地址",class:"invalid-feedback",modelValue:l.form.message,"onUpdate:modelValue":s[4]||(s[4]=o=>l.form.message=o)},null,8,["modelValue"])]),ee,te]),_:1},8,["onSubmit"])])],64)}const oe=C(U,[["render",se]]);export{oe as default};
